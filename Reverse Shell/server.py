import socket 
import subprocess
import os

def start_server():
    # Set the host and port for the server
    host = '192.168.1.5'
    port = 12357

    # Create a socket object using IPv4 and TCP
    server_socket = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    server_socket.bind((host, port))
    server_socket.listen(1)

    # Display server information
    print(f"Server listening on {host}:{port}")

    # Accept a connection from a client
    conn, addr = server_socket.accept()
    print(f"Connection from {addr}")

    # Main loop to receive commands from the user
    while True:
        # Get user input for a command
        command = input("Enter a command (or 'exit' to close):‌")

        # Check if the user wants to exit
        if command.lower() == 'exit':
            conn.send(command.encode())
            break
        # Check if the command is a change directory command
        elif command.startswith('cd '):
            try:
                # Attempt to change the directory and get the result
                os.chdir(command[3:])
                result = "Changed directory to " + os.getcwd() + "\nFiles in the directory:\n" + "\n".join(os.listdir())
            except Exception as e:
                # Handle the exception if changing directory fails
                result = f"Error Changing directory:‌ {str(e)}"
        else:
            # Send the command to the client
            conn.send(command.encode())
            # Receive the result from the client
            result = conn.recv(4096).decode()
        
        # Display the result from the client
        print(f"Result from client:‌\n {result}")

    # Close the connection and the server socket
    conn.close()
    server_socket.close()

if __name__ == "__main__":
    # Start the server when the script is executed
    start_server()
